<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <title>Usuários</title>
    </h:head>
    <ui:decorate template="../Template/standardAdmin.xhtml">
        <ui:define name="conteudo">
            <p:panel header="Usuários..." style="width: 1800px; text-align: left; float: left">
                <h:form id="frmTblUsuario">
                    <p:dataTable 
                        id="tblUsuario"
                        value="#{usuarioMB.getAllUsuarios()}" var="p" 
                        emptyMessage="Nenhum registro encontrado..."
                        widgetVar="usuarioListarTable"                                     
                        rowKey="#{p.id_usu}" selectionMode="single"                                
                        paginator="true" rows="10" rowsPerPageTemplate="5,10,15"
                        >
                        
                        <f:facet name="header">
                            <p:outputPanel>  
                                <div style="text-align: left; float: left">
                                    <!-- <h:outputLabel value="Localizar: " />  
                                        <p:inputText id="globalFilter" onkeyup="usuarioListarTable.filter()" style="width:150px" />
                                    <h:outputLabel value="Tipo: " />  
                                    <p:selectOneMenu id="tipoUsu" value="" style="width: 180px" >
                                        <f:selectItem itemLabel="Todos" itemValue="" />
                                        <f:selectItem itemLabel="Administrador" itemValue=""/>
                                        <f:selectItem itemLabel="Cliente" itemValue=""/>
                                    </p:selectOneMenu> -->
                                    <p:commandButton value="Novo" title="Cadastrar Novo Usuário" image="ui-icon-document" oncomplete="dialogUsuario.show();" update=":frmUsuarioModal">                                        
                                        <f:setPropertyActionListener target="#{usuarioMB.addNewReg}" value="true" />
                                        <f:setPropertyActionListener target="#{usuarioMB.usu}" value="#{null}" />
                                    </p:commandButton>
                                </div>                                                                
                            </p:outputPanel>                            
                        </f:facet>
                        
                        <p:columnGroup type="header">
                            <p:row>
                                <p:column rowspan="2" headerText="Cód" style="text-align: left; width: 20px" 
                                            filterBy="#{p.id_usu}" filterStyle="display: none" />                                
                                <p:column rowspan="2" headerText="Nome" style="text-align: left" 
                                            filterBy="#{p.nome_usu}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="Usuário" style="text-align: left" 
                                            filterBy="#{p.usuario}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="Senha" style="text-align: left" 
                                            filterBy="#{p.senha}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="E-mail" style="text-align: left" 
                                            filterBy="#{p.email}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="Telefone" style="text-align: left; width: 90px" 
                                            filterBy="#{p.telefone}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="Endereço" style="text-align: left" 
                                            filterBy="#{p.endereco}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="CPF" style="text-align: left; width: 95px" 
                                            filterBy="#{p.cpf}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="Nível" style="text-align: left; width: 40px" 
                                            filterBy="#{p.nivel}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="Status" style="text-align: left; width: 40px" 
                                            filterBy="#{p.ativo}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="Criado" style="text-align: left; width: 160px" 
                                            filterBy="#{p.criado}" filterStyle="display: none" />
                                <p:column rowspan="2" headerText="Modificado" style="text-align: left; width: 160px" 
                                            filterBy="#{p.modificado}" filterStyle="display: none" />
                                <p:column colspan="2" headerText="Ações" />
                            </p:row>

                            <p:row>
                                <p:column headerText="Alterar" style="text-align: center; font-style: italic; width: 1px" />
                                <p:column headerText="Excluir" style="text-align: center; font-style: italic; width: 1px" />
                            </p:row>
                        </p:columnGroup>
                        
                        <p:column style="text-align: center; width: 20px">
                            <h:outputLabel value="#{p.id_usu}" />                    
                        </p:column>

                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.nome_usu}" />                    
                        </p:column>             

                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.usuario}" />                    
                        </p:column>
                        
                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.senha}" />                    
                        </p:column>
                        
                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.email}" />                    
                        </p:column>
                        
                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.telefone}" />                    
                        </p:column>
                        
                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.endereco}" />                    
                        </p:column>
                        
                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.cpf}" />                    
                        </p:column>
                        
                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.nivel}" />                    
                        </p:column>
                        
                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.ativo}" />                    
                        </p:column>
                        
                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.criado}" />                    
                        </p:column>
                        
                        <p:column style="text-align: center">
                            <h:outputLabel value="#{p.modificado}" />                    
                        </p:column>

                        <p:column style="text-align: center; width: 1px">
                            <p:commandButton value="Alterar" image="ui-icon-pencil" title="Alterar Usuário" 
                                             update=":frmUsuarioModal" oncomplete="dialogUsuario.show();" >                                    
                                <f:setPropertyActionListener target="#{usuarioMB.addNewReg}" value="false" />
                                <f:setPropertyActionListener target="#{usuarioMB.usu}" value="#{p}" />                                                                        
                            </p:commandButton>                                
                        </p:column>                                 

                        <p:column style="text-align: center; width: 1px">
                            <p:commandButton value="Excluir" image="ui-icon-trash" title="Excluir Usuário"
                                                onclick="confirmation.show();"
                                                update=":frmRemoveCliente" >
                                <f:setPropertyActionListener target="#{usuarioMB.addNewReg}" value="false" />
                                <f:setPropertyActionListener target="#{usuarioMB.usu}" value="#{p}" />
                            </p:commandButton> 
                        </p:column>
                        <f:facet name="footer">
                            <div style="text-align: left; float: left">
                                <p:ajaxStatus id="ajaxStatusPanel">  
                                    <f:facet name="start">  
                                        <div style="background-color: white; color: black; vertical-align: middle">
                                            Carregando...
                                        </div>
                                    </f:facet> 
                                    <f:facet name="complete">  
                                        <h:outputText value="" />  
                                    </f:facet>  
                                </p:ajaxStatus>
                            </div>
                            <!--<div style="text-align: right; float: right">                                    
                                <h:outputLabel value="Quantidade: " />
                                <h:outputText value="{usuarioMB.totalUsuarios()}"/>
                            </div> -->                                                      
                        </f:facet>               
                        
                    </p:dataTable>
                </h:form>
                
                <p:dialog id="dialog" header="Usuario" widgetVar="dialogUsuario" 
                            appendToBody="true" resizable="true" closable="false"
                            modal="true" showEffect="fade" hideEffect="fade" width="500">             

                    <h:form id="frmUsuarioModal">
                        <p:growl id="messageGrowl" showDetail="false" life="3000">    
                        <h:panelGrid id="infosUsuario" columns="3" style="margin-bottom:10px">
                            <p:outputLabel for="id_usu" value="Código:" />
                            <p:inputText id="id_usu" value="#{usuarioMB.usu.id_usu}" disabled="true" size="5"/>
                            <p:message for="id_usu" display="text"/> 

                            <p:outputLabel for="nome_usu" value="Nome:" />
                            <p:inputText id="nome_usu" value="#{usuarioMB.usu.nome_usu}" 
                                            required="true" requiredMessage="Valor inválido." size="35" maxlength="100"/>
                            <p:message for="nome_usu" display="text" /> 

                            <p:outputLabel for="usuario" value="Usuário:" />                                    
                            <p:inputText id="usuario" value="#{usuarioMB.usu.usuario}" 
                                            required="true" requiredMessage="Valor inválido." size="35" maxlength="20"/>
                            <p:message for="usuario" display="text"/>      

                            <p:outputLabel for="senha" value="Senha:" />
                            <p:inputText id="senha" value="#{usuarioMB.usu.senha}" 
                                            required="true" requiredMessage="Valor inválido." maxlength="20"/>
                            <p:message for="senha" display="text"/> 

                            <p:outputLabel for="email" value="E-mail:" />
                            <p:inputText id="email" value="#{usuarioMB.usu.email}" 
                                            required="true" requiredMessage="Valor inválido." size="35" maxlength="40"/>
                            <p:message for="email" display="text"/>

                            <p:outputLabel for="telefone" value="Telefone:" />
                            <p:inputMask id="telefone" value="#{usuarioMB.usu.telefone}" mask="(99)9999-9999" 
                                            required="true" requiredMessage="Valor inválido" size="35" maxlength="10" />
                            <p:message for="telefone" display="text"/>

                            <p:outputLabel for="endereco" value="Endereço:" />
                            <p:inputText id="endereco" value="#{usuarioMB.usu.endereco}" 
                                            required="true" requiredMessage="Valor inválido." size="35" maxlength="50"/>
                            <p:message for="endereco" display="text"/>

                            <p:outputLabel for="cpf" value="CPF:" />
                            <p:inputMask id="cpf" value="#{usuarioMB.usu.cpf}"
                                            mask="999.999.999-99" required="true" requiredMessage="Valor inválido" size="35" maxlength="11" />
                            <p:message for="cpf" display="text"/>

                            <p:outputLabel for="nivel" value="Nível:" />
                            <p:selectOneMenu id="nivel" value="#{usuarioMB.usu.nivel}" style="width: 180px" >
                                <f:selectItem itemLabel="Administrador" itemValue="1"/>
                                <f:selectItem itemLabel="Cliente" itemValue="2"/>
                            </p:selectOneMenu>
                            <p:message for="nivel" display="text"/>

                            <p:outputLabel for="ativo" value="Status:" />
                            <p:selectOneMenu id="ativo" value="#{usuarioMB.usu.ativo}" style="width: 180px" >
                                <f:selectItem itemLabel="Ativo" itemValue="true"/>
                                <f:selectItem itemLabel="Inativo" itemValue="false"/>
                            </p:selectOneMenu>
                            <p:message for="ativo" display="text"/>
                        </h:panelGrid>
                        <p:separator />
                        <p:commandButton value="Salvar" image="ui-icon-disk" title="Salvar"
                                            actionListener="#{usuarioMB.salvar()}" 
                                            update="frmUsuarioModal:messageGrowl, infosUsuario, :frmTblUsuario"
                                            oncomplete="handleRequest(xhr, status, args);"/>                            

                        <script type="text/javascript">  
                            function handleRequest(xhr, status, args) {  
                                if (args.validationFailed || args.KEEP_DIALOG_OPENED) {                                            
                                    jQuery('#dialog').effect("shake", { times:3 }, 100);
                                } else {
                                    dialogUsuario.hide();
                                }
                            }  								  
                        </script>                        
                        <p:commandButton value="Cancelar" title="Cancelar" 
                                        immediate="true" oncomplete="dialogUsuario.hide();" 
                                        image="ui-icon-close" />
                        </p:growl>
                    </h:form>  
                </p:dialog>  
                
                <p:confirmDialog id="confirmDialog" message="Confirma exclusão do usuário?"  
                                header="Confirme" severity="alert" widgetVar="confirmation" appendToBody="true" >                    

                    <h:form id="frmRemoveCliente">                               
                        <p:growl id="messageGrowl1" showDetail="false" life="3000">
                        <p:commandButton value="Sim"
                                            oncomplete="confirmation.hide()" image="ui-icon-trash"
                                            update=":frmTblUsuario, frmRemoveCliente:messageGrowl1"
                                            actionListener="#{usuarioMB.excluir()}"/>  
                        <p:commandButton immediate="true" value="Não" 
                                            image="ui-icon-cancel"
                                            onclick="confirmation.hide()" />      
                        </p:growl>
                    </h:form>                  
                </p:confirmDialog>
            </p:panel>
        </ui:define>
    </ui:decorate>
</html>
